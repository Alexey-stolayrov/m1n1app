<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üéÆ –ú–∏–Ω–∏-–ò–≥—Ä—ã</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    min-height: 100vh;
}
.container { max-width: 400px; margin: 0 auto; padding: 20px; }
.header { text-align: center; margin-bottom: 20px; }
.game-card {
    background: rgba(255,255,255,0.12);
    border-radius: 15px;
    padding: 20px;
    margin: 15px 0;
}
.btn {
    width: 100%;
    padding: 15px;
    margin-top: 10px;
    border-radius: 12px;
    border: none;
    font-size: 18px;
    font-weight: bold;
}
.btn-success { background: linear-gradient(135deg, #4cd964, #5ac8fa); color: white; }
.btn-danger { background: linear-gradient(135deg, #ff5858, #f09819); color: white; }
.btn-primary { background: linear-gradient(135deg, #f093fb, #f5576c); color: white; }
.hidden { display: none; }

/* ===== –ë–ê–®–ù–Ø ===== */
.tower {
    width: 120px;
    min-height: 300px;
    background: rgba(0,0,0,0.2);
    margin: 20px auto;
    border-radius: 10px;
    display: flex;
    flex-direction: column-reverse;
    align-items: center;
}
.floor {
    width: 90%;
    height: 18px;
    background: linear-gradient(135deg, #d2691e, #8b4513);
    border-radius: 4px;
    margin: 2px 0;
}

/* ===== MONETA ===== */
.coin {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    margin: 20px auto;
    background: linear-gradient(135deg, gold, orange);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 32px;
    font-weight: bold;
    color: black;
    transition: transform 0.8s;
}
.coin.flip { transform: rotateY(720deg); }

/* ===== DICE ===== */
.dice {
    width: 100px;
    height: 100px;
    border-radius: 20px;
    background: white;
    color: black;
    font-size: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 20px auto;
    transition: transform 0.4s;
}
.dice.roll { transform: rotate(360deg) scale(1.1); }
</style>
</head>

<body>
<div class="container">

<div class="header">
    <h1>üéÆ –ú–∏–Ω–∏-–ò–≥—Ä—ã</h1>
</div>

<!-- ===== MENU ===== -->
<div id="mainMenu">
    <div class="game-card">
        <h2>üèóÔ∏è –ü–æ—Å—Ç—Ä–æ–π–∫–∞ –±–∞—à–Ω–∏</h2>
        <button class="btn btn-primary" onclick="startGame('tower_build')">–ò–≥—Ä–∞—Ç—å</button>
    </div>
    <div class="game-card">
        <h2>ü™ô –ú–æ–Ω–µ—Ç–∫–∞</h2>
        <button class="btn btn-success" onclick="startGame('coin_flip')">–ò–≥—Ä–∞—Ç—å</button>
    </div>
    <div class="game-card">
        <h2>üé≤ –ö—É–±–∏–∫</h2>
        <button class="btn btn-success" onclick="startGame('dice_roll')">–ò–≥—Ä–∞—Ç—å</button>
    </div>
</div>

<!-- ===== –ë–ê–®–ù–Ø ===== -->
<div id="towerGame" class="hidden">
    <div class="game-card">
        <h2>üèóÔ∏è –°—Ç—Ä–æ–π –±–∞—à–Ω—é</h2>
        <p>–£–¥–µ—Ä–∂–∏–≤–∞–π –∫–Ω–æ–ø–∫—É</p>

        <div class="tower" id="tower"></div>
        <p>–≠—Ç–∞–∂–∏: <span id="height">0</span></p>

        <button class="btn btn-primary"
            onmousedown="startBuilding()"
            ontouchstart="startBuilding()"
            onmouseup="stopBuilding()"
            ontouchend="stopBuilding()">‚¨áÔ∏è –°–¢–†–û–ò–¢–¨</button>

        <button class="btn btn-danger" onclick="backToMenu()">–ù–∞–∑–∞–¥</button>
    </div>
</div>

<!-- ===== MONETA ===== -->
<div id="coinGame" class="hidden">
    <div class="game-card">
        <h2>ü™ô –û—Ä—ë–ª –∏–ª–∏ —Ä–µ—à–∫–∞</h2>
        <div id="coin" class="coin">ü™ô</div>
        <button class="btn btn-success" onclick="flipCoin('heads')">–û–†–Å–õ</button>
        <button class="btn btn-danger" onclick="flipCoin('tails')">–†–ï–®–ö–ê</button>
        <button class="btn" onclick="backToMenu()">–ù–∞–∑–∞–¥</button>
    </div>
</div>

<!-- ===== DICE ===== -->
<div id="diceGame" class="hidden">
    <div class="game-card">
        <h2>üé≤ –£–≥–∞–¥–∞–π —á–∏—Å–ª–æ</h2>
        <div id="dice" class="dice">?</div>
        <div>
            <button class="btn" onclick="guessDice(1)">1</button>
            <button class="btn" onclick="guessDice(2)">2</button>
            <button class="btn" onclick="guessDice(3)">3</button>
        </div>
        <div>
            <button class="btn" onclick="guessDice(4)">4</button>
            <button class="btn" onclick="guessDice(5)">5</button>
            <button class="btn" onclick="guessDice(6)">6</button>
        </div>
        <button class="btn" onclick="backToMenu()">–ù–∞–∑–∞–¥</button>
    </div>
</div>

</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

let currentGame = '';
let towerHeight = 0;
let buildInterval;

/* ===== NAV ===== */
function startGame(game) {
    currentGame = game;
    mainMenu.classList.add("hidden");
    if (game === 'tower_build') towerGame.classList.remove("hidden");
    if (game === 'coin_flip') coinGame.classList.remove("hidden");
    if (game === 'dice_roll') diceGame.classList.remove("hidden");
}

function backToMenu() {
    towerGame.classList.add("hidden");
    coinGame.classList.add("hidden");
    diceGame.classList.add("hidden");
    mainMenu.classList.remove("hidden");
}

/* ===== –ë–ê–®–ù–Ø ===== */
function startBuilding() {
    buildInterval = setInterval(() => {
        towerHeight++;
        height.textContent = towerHeight;

        const floor = document.createElement("div");
        floor.className = "floor";
        tower.appendChild(floor);

        if (towerHeight >= 100) stopBuilding(true);
    }, 100);
}

function stopBuilding(auto=false) {
    clearInterval(buildInterval);
    setTimeout(() => {
        if (towerHeight > 0) {
            tg.sendData(JSON.stringify({
                game_type: "tower_build",
                bet: 100,
                score: towerHeight
            }));
            resetTower();
        }
    }, auto ? 0 : 800);
}

function resetTower() {
    tower.innerHTML = "";
    towerHeight = 0;
    height.textContent = "0";
}

/* ===== MONETA ===== */
function flipCoin(choice) {
    coin.classList.add("flip");
    setTimeout(() => {
        coin.classList.remove("flip");
        tg.sendData(JSON.stringify({
            game_type: "coin_flip",
            bet: 50,
            choice: choice
        }));
    }, 800);
}

/* ===== DICE ===== */
function guessDice(num) {
    dice.classList.add("roll");
    setTimeout(() => {
        dice.textContent = num;
        dice.classList.remove("roll");
        tg.sendData(JSON.stringify({
            game_type: "dice_roll",
            bet: 75,
            guess: num
        }));
    }, 500);
}
</script>

</body>
</html>
