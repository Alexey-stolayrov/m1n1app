<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üéÆ Mini Games</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
    font-family: 'Segoe UI', system-ui, sans-serif;
    background: radial-gradient(circle at top, #1b1f3b, #0f1224);
    color: white;
    min-height: 100vh;
}

.container {
    max-width: 420px;
    margin: auto;
    padding: 20px;
}

.header {
    text-align: center;
    margin-bottom: 25px;
}

.game-card {
    background: rgba(255,255,255,0.08);
    backdrop-filter: blur(14px);
    border-radius: 18px;
    padding: 22px;
    margin-bottom: 18px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.35);
}

.btn {
    width: 100%;
    padding: 14px;
    margin-top: 12px;
    border-radius: 14px;
    border: none;
    font-size: 17px;
    font-weight: 700;
    color: white;
}

.btn-primary {
    background: linear-gradient(135deg, #ff6fd8, #ff8c7f);
}

.btn-success {
    background: linear-gradient(135deg, #32d2aa, #3aa1ff);
}

.btn-danger {
    background: linear-gradient(135deg, #ff5858, #f09819);
}

.hidden { display: none; }

/* ===== –ë–ê–®–ù–Ø ===== */
.tower-wrapper {
    width: 120px;
    height: 260px;
    margin: 20px auto;
    background: rgba(0,0,0,0.3);
    border-radius: 14px;
    overflow: hidden;
}

.tower-fill {
    width: 100%;
    height: 0%;
    background: linear-gradient(180deg, #ffd56b, #ff8c00);
    transition: height 0.1s;
}

.percent {
    text-align: center;
    font-size: 22px;
    font-weight: bold;
    margin-top: 10px;
}

/* ===== MONETA ===== */
.coin {
    width: 130px;
    height: 130px;
    border-radius: 50%;
    margin: 20px auto;
    background: radial-gradient(circle at top, gold, orange);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 42px;
    color: #222;
}

/* ===== DICE ===== */
.dice {
    width: 110px;
    height: 110px;
    border-radius: 22px;
    background: white;
    color: black;
    font-size: 42px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 20px auto;
}
</style>
</head>

<body>
<div class="container">

<div class="header">
    <h1>üéÆ MINI GAMES</h1>
</div>

<!-- MENU -->
<div id="mainMenu">
    <div class="game-card">
        <h2>üèóÔ∏è –ë–∞—à–Ω—è</h2>
        <button class="btn btn-primary" onclick="startGame('tower_build')">–ò–≥—Ä–∞—Ç—å</button>
    </div>

    <div class="game-card">
        <h2>ü™ô –ú–æ–Ω–µ—Ç–∫–∞</h2>
        <button class="btn btn-success" onclick="startGame('coin_flip')">–ò–≥—Ä–∞—Ç—å</button>
    </div>

    <div class="game-card">
        <h2>üé≤ –ö—É–±–∏–∫</h2>
        <button class="btn btn-danger" onclick="startGame('dice_roll')">–ò–≥—Ä–∞—Ç—å</button>
    </div>
</div>

<!-- –ë–ê–®–ù–Ø -->
<div id="towerGame" class="hidden">
    <div class="game-card">
        <h2>üèóÔ∏è –£–¥–µ—Ä–∂–∏–≤–∞–π –∫–Ω–æ–ø–∫—É</h2>

        <div class="tower-wrapper">
            <div id="towerFill" class="tower-fill"></div>
        </div>

        <div class="percent"><span id="percent">0</span>%</div>

        <button class="btn btn-primary"
            onmousedown="startBuilding()"
            ontouchstart="startBuilding()"
            onmouseup="stopBuilding()"
            ontouchend="stopBuilding()">‚¨áÔ∏è –°–¢–†–û–ò–¢–¨</button>

        <button class="btn btn-danger" onclick="backToMenu()">–ù–∞–∑–∞–¥</button>
    </div>
</div>

<!-- MONETA -->
<div id="coinGame" class="hidden">
    <div class="game-card">
        <h2>ü™ô –û—Ä—ë–ª –∏–ª–∏ —Ä–µ—à–∫–∞</h2>
        <div class="coin">ü™ô</div>
        <button class="btn btn-success" onclick="flipCoin('heads')">–û–†–Å–õ</button>
        <button class="btn btn-danger" onclick="flipCoin('tails')">–†–ï–®–ö–ê</button>
        <button class="btn" onclick="backToMenu()">–ù–∞–∑–∞–¥</button>
    </div>
</div>

<!-- DICE -->
<div id="diceGame" class="hidden">
    <div class="game-card">
        <h2>üé≤ –ö—É–±–∏–∫</h2>
        <div class="dice">?</div>
        <button class="btn" onclick="guessDice(1)">1</button>
        <button class="btn" onclick="guessDice(2)">2</button>
        <button class="btn" onclick="guessDice(3)">3</button>
        <button class="btn" onclick="guessDice(4)">4</button>
        <button class="btn" onclick="guessDice(5)">5</button>
        <button class="btn" onclick="guessDice(6)">6</button>
        <button class="btn" onclick="backToMenu()">–ù–∞–∑–∞–¥</button>
    </div>
</div>

</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

let currentGame = '';
let percent = 0;
let interval;
let finished = false;

/* NAV */
function startGame(game) {
    currentGame = game;
    mainMenu.classList.add('hidden');
    if (game === 'tower_build') resetTower(), towerGame.classList.remove('hidden');
    if (game === 'coin_flip') coinGame.classList.remove('hidden');
    if (game === 'dice_roll') diceGame.classList.remove('hidden');
}

function backToMenu() {
    clearInterval(interval);
    towerGame.classList.add('hidden');
    coinGame.classList.add('hidden');
    diceGame.classList.add('hidden');
    mainMenu.classList.remove('hidden');
}

/* –ë–ê–®–ù–Ø */
function resetTower() {
    percent = 0;
    finished = false;
    percentEl.textContent = 0;
    towerFill.style.height = '0%';
}

const percentEl = document.getElementById('percent');
const towerFill = document.getElementById('towerFill');

function startBuilding() {
    if (finished) return;

    interval = setInterval(() => {
        percent++;
        percentEl.textContent = percent;
        towerFill.style.height = percent + '%';

        // —à–∞–Ω—Å –ø–∞–¥–µ–Ω–∏—è
        let risk = 0;
        if (percent > 30) risk = percent / 120;

        if (Math.random() < risk) {
            endTower();
        }

        if (percent >= 100) {
            endTower();
        }
    }, 100);
}

function stopBuilding() {
    clearInterval(interval);
    if (!finished && percent > 0) {
        endTower();
    }
}

function endTower() {
    if (finished) return;
    finished = true;
    clearInterval(interval);

    tg.sendData(JSON.stringify({
        game_type: 'tower_build',
        bet: 100,
        score: percent
    }));
}

/* MONETA */
function flipCoin(choice) {
    tg.sendData(JSON.stringify({
        game_type: 'coin_flip',
        bet: 50,
        choice
    }));
}

/* DICE */
function guessDice(num) {
    tg.sendData(JSON.stringify({
        game_type: 'dice_roll',
        bet: 75,
        guess: num
    }));
}
</script>
</body>
</html>
